<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AuthController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SIRHA-BackEnd</a> &gt; <a href="index.source.html" class="el_package">edu.dosw.sirha.sirha_backend.controller</a> &gt; <span class="el_source">AuthController.java</span></div><h1>AuthController.java</h1><pre class="source lang-java linenums">package edu.dosw.sirha.sirha_backend.controller;

import jakarta.validation.Valid;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import edu.dosw.sirha.sirha_backend.dto.AuthResponse;
import edu.dosw.sirha.sirha_backend.dto.LoginRequest;
import edu.dosw.sirha.sirha_backend.dto.RegisterRequest;
import edu.dosw.sirha.sirha_backend.service.AuthService;

/**
 * Controlador REST para el manejo de autenticación y registro de usuarios en el sistema SIRHA.
 * 
 * Este controlador proporciona endpoints para:
 * - Autenticación de usuarios existentes (login)
 * - Registro de nuevos usuarios en el sistema
 * 
 * Todos los endpoints están mapeados bajo la ruta base &quot;/api/auth&quot; y manejan
 * peticiones HTTP con formato JSON para el intercambio de datos.

 * @see AuthService
 * @see AuthResponse
 * @see LoginRequest
 */
@RestController
@RequestMapping(&quot;/api/auth&quot;)
@CrossOrigin(origins = &quot;*&quot;)
public class AuthController {

    private final AuthService authService;

<span class="fc" id="L35">    public AuthController(AuthService authService) {</span>
<span class="fc" id="L36">        this.authService = authService;</span>
<span class="fc" id="L37">    }</span>

    /**
     * Endpoint para autenticar usuarios en el sistema.
     * 
     * Recibe las credenciales del usuario (username y password) y valida
     * su autenticidad contra la base de datos. Si las credenciales son válidas,
     * retorna un token de autenticación junto con el nombre de usuario.
     * 
     * En caso de credenciales inválidas, retorna un código de error 401 (Unauthorized)
     * con un mensaje descriptivo del error.
     * 
     * @param request objeto que contiene las credenciales de autenticación
     *               (username y password). No debe ser null.
     */
    @PostMapping(&quot;/login&quot;)
    public ResponseEntity&lt;?&gt; login(@Valid @RequestBody LoginRequest request) {
        try {
<span class="nc" id="L55">            AuthResponse response = authService.loginStudent(request);</span>
<span class="nc" id="L56">            return ResponseEntity.ok(response);</span>
<span class="nc" id="L57">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L58">            System.out.println(e.getMessage());</span>
<span class="nc" id="L59">            return ResponseEntity.status(401).body(new LoginRequest(null, e.getMessage()));</span>
<span class="nc" id="L60">        } catch (Exception e) {</span>
<span class="nc" id="L61">            System.out.println(e.getMessage());</span>
<span class="nc" id="L62">            return ResponseEntity.status(500).body(new LoginRequest(null, &quot;Error interno del servidor&quot;));</span>
        }
    }

    /**
     * Endpoint para registrar nuevos usuarios en el sistema.
     * 
     * Crea un nuevo usuario en la base de datos con la información proporcionada.
     * El sistema asigna automáticamente un ID único y hashea la contraseña
     * antes del almacenamiento por seguridad.
     * 
     * Validaciones realizadas:
     * - Username único en el sistema
     * - Contraseña con formato adecuado
     * - Rol válido para el sistema
     * 
     * @param user objeto User con la información del nuevo usuario.
     *            Debe contener username, passwordHash y rol válidos.
     *            No debe ser null.
     */
    @PostMapping(&quot;/register&quot;)
    public ResponseEntity&lt;?&gt; register(@Valid @RequestBody RegisterRequest request) {
        try{
<span class="nc" id="L85">            AuthResponse response = authService.registerStudent(request);</span>
<span class="nc" id="L86">            return ResponseEntity.status(HttpStatus.CREATED).body(response);</span>
<span class="nc" id="L87">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L88">            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(null);</span>
<span class="nc" id="L89">        } catch (Exception e) {</span>
<span class="nc" id="L90">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(null);</span>
        }
    }

    

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>